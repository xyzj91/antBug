/**
 * antBug 蚂蚁bug收集系统
 * author:alen 2018年1月4日
 */
window.antBug=function(e,n){var d={},b=this;b.isInit=!1;d.SERVER_HOST="";d.APP_ID="default";d.DEBUG=!1;b.APIVERSION="1.0";b.messageContent={notifierVersion:b.APIVERSION,userAgent:e.navigator.userAgent,locale:e.navigator.language||e.navigator.userLanguage,url:e.location.href,appId:d.APP_ID,title:n.title,time:(new Date).getTime(),appVersion:"",message:"",fileName:"",lineNumber:"",columnNumber:"",stacktrace:"",type:"",deviceType:"web",osVersion:"",ext:{},breadcrumbs:""};d.collectResourceError=!0;d.collectHttpError=
    !0;d.maxErrorNum=20;b.breadcrumbs=[];d.extend=function(){var a,c,f,b,d,g=arguments[0]||{},e=1,l=arguments.length,k=!1;"boolean"===typeof g&&(k=g,g=arguments[e]||{},e++);"object"===typeof g||$.isFunction(g)||(g={});e===l&&(g=this,e--);for(;e<l;e++)if(null!=(a=arguments[e]))for(c in a)f=g[c],b=a[c],g!==b&&(k&&b&&($.isPlainObject(b)||(d=$.isArray(b)))?(d?(d=!1,f=f&&$.isArray(f)?f:[]):f=f&&$.isPlainObject(f)?f:{},g[c]=$.extend(k,f,b)):void 0!==b&&(g[c]=b));return g};b.send=function(a){var c=new XMLHttpRequest,
    b={type:"get",url:"",data:{},success:function(){},error:function(){}};a&&(b=d.extend(b,a));c.open(b.type,b.url);b.data&&c.send(b);c.onreadystatechange=function(){4==c.readyState&&200==c.status?b.success(xml.responseText):b.error(c.status)}};b.parseError=function(a){var c=JSON.parse(JSON.stringify(b.messageContent));c.message=a.message;c.fileName=a.fileName;c.lineNumber=a.lineNumber;c.columnNumber=a.columnNumber;c.stacktrace=a.stacktrace;c.target=a.target;b.messageContent.breadcrumbs=b.breadcrumbs;
    b.pushBreadcrumbs(a);return c};b.parseErrorMessage=function(a){var c=b.parseError(a),c=d.extend(c,a);a.type||!1===c.message.indexOf("Uncaught")||(c.type="uncaughtError");return c};b.toJsonStr=function(a){if("undefined"!=typeof JSON)return JSON.stringify(a);if(a instanceof Array){for(var c=[],f=0;r<a.length;f++)c.push(b.toJsonStr(a[f]));return"["+c.join(",")+"]"}var c=[],d;for(d in a)if(a.hasOwnProperty(d)){var f='"'+d+'":',e=a[d];e&&("object"==typeof e?f+=b.toJsonStr(e):"number"==typeof e?f+=e:f=
    f+'"'+e.replace(/\n/g,"\\n")+'"',c.push(f))}return"{"+c.join(",")+"}"};b.converData=function(a){var c;try{c=toJsonStr(a)}catch(f){delete a.metaData;try{c=toJsonStr(a)}catch(h){return}}return c};b.isString=function(a){return"string"==typeof a&&a.constructor==String};b.dump=function(a,c){d.DEBUG&&(b.isString(a)||(a=JSON.stringify(a)),console.log(a),c&&console.log(c))};d.error=function(a){d.maxErrorNum&&(--d.maxErrorNum,a=b.converData(b.parseErrorMessage(a)),b.dump(a),a&&b.send({type:"post",url:d.SERVER_HOST,
    data:a,success:function(a){b.dump(a);b.removeBreadcrumbs()},error:function(a){b.dump(a,"\u8bb0\u5f55\u4e0a\u4f20\u5931\u8d25")}}))};b.pushBreadcrumbs=function(a){a.breadcrumbs&&delete a.breadcrumbs;b.breadcrumbs.push(a);b.breadcrumbs.length>d.maxErrorNum&&b.breadcrumbs.shift()};b.removeBreadcrumbs=function(){b.breadcrumbs=[]};b.parseUrl2Xpath=function(a){for(var c=[];a&&a.nodeType==Node.ELEMENT_NODE;a=a.parentNode){var b,d=0,e=!1;for(b=a.previousSibling;b;b=b.previousSibling)b.nodeType!=Node.DOCUMENT_TYPE_NODE&&
b.nodeName==a.nodeName&&++d;for(b=a.nextSibling;b&&!e;b=b.nextSibling)b.nodeName==a.nodeName&&(e=!0);c.splice(0,0,(a.prefix?a.prefix+":":"")+a.localName+(d||e?"["+(d+1)+"]":""))}return c.length?"/"+c.join("/"):null};b.parseSelector=function(a){for(var b=[];a.parentNode;){if(a.id){b.unshift("#"+a.id);break}if(a==a.ownerDocument.documentElement)b.unshift(a.tagName);else{for(var d=1,e=a;e.previousElementSibling;e=e.previousElementSibling,d++);b.unshift(a.tagName+":nth-child("+d+")")}a=a.parentNode}return b.join(" > ")};
    d.resourceErrorAdaper=function(a){if(d.collectResourceError&&!a.message){var c,f=(c=a.target?a.target:a.srcElement)&&c.outerHTML;f&&200<f.length&&(f=f.slice(0,200));var h={type:"resourceError",fileName:c.fileName,lineNumber:a.lineNumber,columnNumber:a.columnNumber,stacktrace:a.stacktrace,target:{outerHTML:f,src:c&&c.src,tagName:c&&c.tagName,id:c&&c.id,className:c&&c.className,name:c&&c.name,type:c&&c.type,XPath:b.parseUrl2Xpath(c),selector:b.parseSelector(c),timeStamp:a.timeStamp}};c.src===e.location.href||
    c.src&&c.src.match(/.*\/(.*)$/)&&!c.src.match(/.*\/(.*)$/)[1]||!h.target.src||!e.XMLHttpRequest||(a=new XMLHttpRequest,a.AntDebug=!0,a.open("HEAD",h.target.src),a.send(),a.onload=function(a){200!==a.target.status&&(h.target.status=a.target.status,h.target.statusText=a.target.statusText);d.error(h)})}};b.listenerError=function(){e.onerror=function(a,b,e,h,m){d.error({message:a,fileName:b,lineNumber:e,columnNumber:h,stacktrace:m})};n.onreadystatechange=function(){}};b.checkHttpStatus=function(a){return d.collectHttpError&&
        (1==a.detail.status||!/^file:\/\/\//.test(a.detail.url))&&2!==parseInt(a.detail.status/100)};d.resourceError=function(){e.addEventListener&&e.addEventListener("error",d.resourceErrorAdaper,!0);b._hashchange=e.onhashchange;e.onhashchange=function(){return b._hashchange.apply(this,arguments)};if(e.XMLHttpRequest&&(b.prototype=XMLHttpRequest.prototype,b.prototype)){var a,c,f,h=b.prototype.open;b.prototype.open=function(b,d){f=(new Date).getTime();a=b;c=d;try{h.apply(this,arguments)}catch(l){console.log("\u8bf7\u6c42\u5931\u8d25")}};
        var m=b.prototype.send;b.prototype.send=function(){var g=this,h=g.onreadystatechange;g.onreadystatechange=function(){if(4===g.readyState){var l=(new Date).getTime()-f,k={type:"XMLHttpRequest",page:{url:e.location.href},detail:{method:a,url:g.responseURL||c,status:g.status,statusText:g.statusText},elapsedTime:l,time:f};b.checkHttpStatus(k)&&d.error({type:"httpError",req:{method:k.detail.method,url:k.detail.url},res:{status:g.status,statusText:g.statusText,response:g.response,elapsedTime:l}})}h&&h.apply(this,
            arguments)};m.apply(this,arguments)}}};d.init=function(a){if(b.isInit)return d;b.isInit=!0;d.resourceError();b.listenerError();a&&(b.messageContent=d.extend(b.messageContent,a))};return d}(window,document);

/**demo 集成时请去掉
antBug.init({
    appVersion: "3.1",//app版本
});
antBug.collectHttpError = false;
antBug.collectResourceError = true;
antBug.SERVER_HOST = "http://www.baidu.com";
 **/
